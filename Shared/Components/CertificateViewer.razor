@implements IDisposable

@using System.Text.Json.Nodes
@using IdentityModel.Client
@using UdapEd.Shared.Services


@if (_certificateView?.TableDisplay.First() != null)
{
    string color = "#E8F5E9";
    int i = 0;


    <MudExpansionPanels Class="@Class">
        <MudExpansionPanel Expanded="true" Style="background-color: #E8F5E9">
            <TitleContent>
                <MudText Typo="Typo.h6">@Title</MudText>
            </TitleContent>
           
            <ChildContent >
               
                        <MudGrid Class="pa-2" Spacing="2">
                            @foreach (KeyValuePair<string, string> keyValuePair in _certificateView?.TableDisplay.First())
                            {
                                if (i % 2 == 0)
                                {
                                    color = "background-color: #E8F5E9;";
                                }
                                else
                                {
                                    color = "background-color: #EDE7F6";
                                }

                                if (keyValuePair.Key == "Authority Information Access")
                                {
                                    <MudItem Class="pa-2" Style="@color" md="6" sm="12" xs="12">
                                        <strong>@keyValuePair.Key</strong>
                                    @if (!string.IsNullOrEmpty(@keyValuePair.Value))
                                    {
                                        <MudButton
                                            IconColor="Color.Info"
                                            StartIcon=@Icons.Material.Filled.Launch
                                            Size="Size.Small"
                                            OnClick="@(() => ResolveIntermediate(keyValuePair.Value))">
                                            <MudText Color="Color.Info">Resolve</MudText>
                                    </MudButton>
                                }
                                else
                                {
                                    //Top level
                                    Title = "Certificate Authority";
                                }
                                    </MudItem>
                                }
                                else if (keyValuePair.Key == "CRL Distribution")
                                {
                                    <MudItem Class="pa-2" Style="@color" md="6" sm="12" xs="12">
                                        <strong>@keyValuePair.Key</strong>
                                        @if (!string.IsNullOrEmpty(@keyValuePair.Value))
                                        {
                                            <MudButton IconColor="Color.Info"
                                                       StartIcon=@Icons.Material.Filled.Launch
                                                       Size="Size.Small"
                                                       OnClick="@(() => ResolveCrl(keyValuePair.Value))">
                                                <MudText Color="Color.Info">Resolve</MudText>
                                            </MudButton>
                                        }
                                    </MudItem>
                                }
                                else
                                {
                                    <MudItem Class="pa-2" Style="@color" md="6" sm="12" xs="12"><strong>@keyValuePair.Key</strong></MudItem>
                                }

                                <MudItem Class="pa-2" Style="@color" md="6" sm="12" xs="12"><pre>@keyValuePair.Value</pre></MudItem>
                                i++;
                            }
                        </MudGrid>
        
            </ChildContent>
        </MudExpansionPanel>
    </MudExpansionPanels>
}